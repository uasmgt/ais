# Скрипты для обработки данных из АИС "Отдых" и АИС "Мосгортур"

## Размещение файлов

Перед использованием скриптов рекомендуется правильно разместить
файлы в системе (в противном случае нужно вручную указать правильные
пути до файлов в скриптах вручную).

Для этого _перед началом работы_ нужно открыть RStudio и в консоли
(нижнее правое окно) выполнить команду `path.expand("~/")`.
Результатом выполнения команды будет _путь до домашней папки_ в вашей
системе. В компьютерах под управлением Windows с большой вероятностью
это будет папка "Документы" (`C/Users/username/Documents/`), но,
возможно, и домашняя папка пользователя(`C/Users/username/`). В MacOS
и Linux это будет домашняя папка пользователя (`/Users/username/` и
`/home/username/` соответственно).

В этой папке нужно разместить файлы следующим образом:

- весь **код** (то есть все скрипты) разместить в папке `git`;
- все выгрузки из АИС "Мосгортур" разместить в папке `aism`;
- все выгрузки из АИС "Отдых" разместить в папке `aiso`.
- создать папку `data` (в неё будут сохраняться результаты выполнения
  скриптов).

### Загрузка данных из АИС "Отдых"

АИС "Отдых" не позволяет выгружать большие массивы (примерно более 35
тысяч строк) за раз (после обработки запроса система "выкидывает"
пользователя из системы).

Для сохранения Реестра заявлений я предлагаю экспортировать данные поэтапно при помощи фильтров "Цель обращения" и "Вид принятого решения": 

1. Цель обращения -> Детский отдых / Статус заявления -> --Не
   выбрано--
2. Цель обращения -> Компенсация за путёвку / Статус заявления ->
   --Не выбрано--
3. Цель обращения -> Молодёжный отдых / Статус заявления -> --Не
   выбрано--
4. Цель обращения -> Сертификат на отдых и оздоровление, 3-7 лет /
   Статус заявления -> --Не выбрано--
5. Цель обращения -> Сертификат на отдых и оздоровление, 7-15 лет /
   Статус заявления -> --Не выбрано--
6. Цель обращения -> Совместный отдых / Статус заявления -> Отказ в
   регистрации
7. Цель обращения -> Совместный отдых / Статус заявления -> Отозвано.
   По инициативе заявителя
8. Цель обращения -> Совместный отдых / Статус заявления -> Отказ в
   предоставлении услуги
9. Цель обращения -> Совместный отдых / Статус заявления -> Услуга
   оказана

Путь до папки, в которую экспортируются файлы, не имеет значения. Для
систематизации я использую следующую схему `aiso/год/дата_выгрузи/`
(например `aiso\2020\20200629\`).

После сохранения файлов необходимо извлечь файлы из zip-архивов. Если
файлы извлекаются в подпапки, то переносить из них файлы не нужно.
Переименовывать файлы не нужно. Удалять архивы необязательно.

**Важно, чтобы в папке не было посторонних xlsx-файлов.**

